# e.g.
ssh jmckinn2@sfe1.nas.nasa.gov
#PASSCODE corresponds to your <pin>+<fobnumber> as one single string (i.e. no <'s >'s or +'s used symbolically just before).
# password requested is your password
ssh pfe
#
# password requested is same password

# we'll assume this is your first time logging in, so you should set things up for harmrad
cd ~
mkdir git
cd git
git clone https://github.com/pseudotensor/harm_harmgit.git
git checkout koralinsert
mv harm_harmgit harmgit
cp batches/pfebatchtest .
cd environmentfiles/pfe
cp .* ~/
cd ~/
# edit .profile and change "jmckinn2" to your username
mkdir bin
mkdir include
mkdir lib


# logout of pfe
exit

# log back into pfe with password
ssh pfe


# can make bin2txt by setting HDF and V5D to 0 in bin2txt.c .  Then remove -lmfhdf -ldf -ljpeg -lz -lv5d from makefile
#module load hdf4/4.2r3 # should be able to use this for hdf, but doesn't find libs
make superclean ; make prepbin2txt ; make bin2txt
cp bin2txt ~/bin/

# can make iinterp normally:
make superclean ; make prepiinterp ; makeiinterp
cp iinterp ~/bin/


# now compile harmrad using normal steps
cd ~/git/harmgit/
git checkout koralinsert # or superedd or subedd for Jane and Danilo
ln -s initboundcode/init.koral.c init.c
ln -s initboundcode/init.koral.h init.h
ln -s initboundcode/bounds.koral.c bounds.c
make superclean ; make prep ; make -j 16 
# confirm created grmhd binary

# setup problem however you want in harmrad
# try to get batch job going:

cd ~/git/harmgit
# edit pfebatchtest
#
# read help about qsub and how to use it on google and http://www.nas.nasa.gov/hecc/support/kb/121/
# try running simple 3D test for 1 hour, so edit batch file accordingly.
# note that one #PBS is a command, while more than one # is a comment.
# "select" stands for number of nodes, each "san" having 16 cores/node.  You need to ensure "select" times cores/node is just barely greater than the number of cores you tell harmrad to use with NTOT later.
# ensure you change my email address to yours.
# ensure you change all directories and usernames.

qsub pfebatchtest

# check on your job:
qstat -u <username>  .  E.g., for me <username> is jmckinn2

# you will get an email when the job starts.

# see using batch system and general pfe usage at: http://www.nas.nasa.gov/hecc/support/kb/

# The run will go into: /nobackup/<username>/<jobname>/  e.g., for this test for me: /nobackup/jmckinn2/jon1/




########
# to run batch dependency, do:
# https://docs.loni.org/wiki/PBS_Job_Chains_and_Dependencies

JOBID=`qsub ./jonharmrad15`
JOBID=`qsub -W depend=afterany:$JOBID ./pfeharmrad15restart`
JOBID=`qsub -W depend=afterany:$JOBID ./pfeharmrad15restart`
#etc.

My example batch files are in harmgit/batches/pfeharmrad15*

# this only works when using latest harm that has auto-select restart -- else risk using truncated restart and failure of start.  Can risk it if want by always asking for the 0 restart file, for example.

# if you want to risk it with old code that doesn't auto-select restart file to use, you can, but don't go crazy with dependency.  Maybe 48 hours total of dependencies is enough (i.e. 48/8 jobs dependent upon each other).  Then in my example above, inside the pfeharmrad15restart, one would replace the 1 -1 with 1 0 in the call to mpiexec at the end.








